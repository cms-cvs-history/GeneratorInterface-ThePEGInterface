process GenSimDigiL1Raw = {
	source = LHESource {
		untracked vstring fileNames = {
			"file:ttbar.lhe"
		}
	}

	untracked PSet maxEvents = { untracked int32 input = -1 }

	untracked PSet configurationMetadata = {
		untracked string version = "alpha"
		untracked string name = "LHEF input"
		untracked string annotation = "ttbar"
	}

	include "Configuration/StandardSequences/data/Generator.cff"

	# CMSSW config file language FAIL!
	replace RandomNumberGeneratorService = RandomNumberGeneratorService {
		PSet generator = {
			 untracked uint32 initialSeed = 123456789
			 untracked string engineName = "HepJamesRandom"
		}
		PSet VtxSmeared = {
			 untracked uint32 initialSeed = 98765432
			 untracked string engineName = "HepJamesRandom"
		}
		PSet g4SimHits = {
			 untracked uint32 initialSeed = 11
			 untracked string engineName = "HepJamesRandom"
		}
		PSet mix = {
			 untracked uint32 initialSeed = 12345
			 untracked string engineName = "HepJamesRandom"
		}
		PSet simSiPixelDigis = {
			 untracked uint32 initialSeed = 1234567
			 untracked string engineName = "HepJamesRandom"
		}
		PSet simSiStripDigis = {
			 untracked uint32 initialSeed = 1234567
			 untracked string engineName = "HepJamesRandom"
		}
		PSet simEcalUnsuppressedDigis = {
			 untracked uint32 initialSeed = 1234567
			 untracked string engineName = "HepJamesRandom"
		}
		PSet simHcalUnsuppressedDigis = {
			 untracked uint32 initialSeed = 11223344
			 untracked string engineName = "HepJamesRandom"
		}
		PSet simMuonCSCDigis = {
			 untracked uint32 initialSeed = 11223344
			 untracked string engineName = "HepJamesRandom"
		}
		PSet simMuonDTDigis = {
			 untracked uint32 initialSeed = 1234567
			 untracked string engineName = "HepJamesRandom"
		}
		PSet simMuonRPCDigis = {
			 untracked uint32 initialSeed = 1234567
			 untracked string engineName = "HepJamesRandom"
		}
	}

	include "FWCore/MessageService/data/MessageLogger.cfi"
	replace MessageLogger.cerr.threshold = "INFO"

	include "GeneratorInterface/ThePEGInterface/data/herwigDefaults.cff"

	module generator = LHEProducer {
		untracked uint32 eventsToPrint = 1

		PSet hadronisation = {
			string generator = "ThePEG"

			using herwigDefaultsBlock

			vstring configFiles = {}
			vstring parameterSets = {
				"cmsDefaults",
				"disableCtau10mmDecays",
				"lheDefaults",
				"lheDefaultPDFs"
			}
		}
	}

	include "Configuration/StandardSequences/data/VtxSmearedBetafuncEarlyCollision.cff"

	replace VtxSmeared.src = generator
	replace genEventWeight.src = generator
	replace genEventScale.src = generator
	replace genEventPdfInfo.src = generator
	replace genParticles.src = generator
	replace genParticleCandidates.src = generator

	replace genParticles.abortOnUnknownPDGCode = false

	include "Configuration/StandardSequences/data/Simulation.cff"
	include "Configuration/StandardSequences/data/MixingNoPileUp.cff"

	replace g4SimHits.Generator.HepMCProductLabel = generator
	replace mergedtruth.HepMCDataLabels += "generator"

	include "Configuration/StandardSequences/data/Geometry.cff"
	include "Configuration/StandardSequences/data/MagneticField.cff"
	include "Configuration/StandardSequences/data/FrontierConditions_GlobalTag.cff"

	include "Configuration/StandardSequences/data/L1Emulator.cff"
	include "Configuration/StandardSequences/data/DigiToRaw.cff"
	include "Configuration/StandardSequences/data/Reconstruction.cff"

	path p0 = { generator, pgen }
	path p1 = { generator, psim }
	path p2 = { generator, pdigi, L1Emulator }
	path p3 = { generator, DigiToRaw }

	include "Configuration/EventContent/data/EventContent.cff"

	module GENSIMDIGIL1RAW = PoolOutputModule {
		using FEVTSIMEventContent
		untracked string fileName = "raw.root"
		untracked PSet SelectEvents = {
			vstring SelectEvents = { "p0" }
		}
		untracked PSet dataset = {
			untracked string dataTier = "GEN"
		}
	}
	replace GENSIMDIGIL1RAW.outputCommands += "keep *_source_*_*"
	replace GENSIMDIGIL1RAW.outputCommands += "keep *_generator_*_*"

	endpath outpath = { GENSIMDIGIL1RAW }

	schedule = { p0, p1, p2, p3, outpath }
}
