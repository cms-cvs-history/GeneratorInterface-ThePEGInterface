process Gen = {
	source = EmptySource {}

	untracked PSet maxEvents = { untracked int32 input = 100 }

	untracked PSet configurationMetadata = {
		untracked string version = "alpha"
		untracked string name = "LHEF input"
		untracked string annotation = "ttbar"
	}

	include "Configuration/StandardSequences/data/Generator.cff"

	# CMSSW config file language FAIL!
	replace RandomNumberGeneratorService = RandomNumberGeneratorService {
		PSet generator = {
			untracked uint32 initialSeed = 123456789
			untracked string engineName = "HepJamesRandom"
		}
		PSet VtxSmeared = {
			untracked uint32 initialSeed = 98765432
			untracked string engineName = "HepJamesRandom"
		}
	}

	include "FWCore/MessageService/data/MessageLogger.cfi"
	replace MessageLogger.cerr.threshold = "INFO"

	include "GeneratorInterface/ThePEGInterface/data/herwigDefaults.cff"

	module generator = ThePEGProducer {
		untracked uint32 eventsToPrint = 1

		using herwigDefaultsBlock

		vstring configFiles = {
#			"MSSM.model"
		}

		vstring parameterSets = {
			"cmsDefaults",
			"disableCtau10mmDecays",
#			"mssm",
			"validation"
		}

		vstring mssm = {
			"cd /Herwig/NewPhysics",
			"set HPConstructor:IncludeEW No",
			"set TwoBodyDC:CreateDecayModes No",
			"setup MSSM/Model ${HERWIGPATH}/SPhenoSPS1a.spc",
			"insert NewModel:DecayParticles 0 /Herwig/Particles/~d_L",
			"insert NewModel:DecayParticles 1 /Herwig/Particles/~u_L",
			"insert NewModel:DecayParticles 2 /Herwig/Particles/~e_R-",
			"insert NewModel:DecayParticles 3 /Herwig/Particles/~mu_R-",
			"insert NewModel:DecayParticles 4 /Herwig/Particles/~chi_10",
			"insert NewModel:DecayParticles 5 /Herwig/Particles/~chi_20",
			"insert NewModel:DecayParticles 6 /Herwig/Particles/~chi_2+"
		}

		vstring validation = {
			"cd /Herwig/MatrixElements/",
			"insert SimpleQCD:MatrixElements[0] MEQCD2to2",
			"set /Herwig/Cuts/QCDCuts:MHatMin 20.*GeV"
		}
	}

	include "Configuration/StandardSequences/data/VtxSmearedGauss.cff"

	replace VtxSmeared.src = generator
	replace genEventWeight.src = generator
	replace genEventScale.src = generator
	replace genEventPdfInfo.src = generator
	replace genParticles.src = generator
	replace genParticleCandidates.src = generator

	replace genParticles.abortOnUnknownPDGCode = false

	include "SimGeneral/HepPDTESSource/data/pythiapdt.cfi"

	path p0 = { generator, pgen }

	include "Configuration/EventContent/data/EventContent.cff"

	module printList = ParticleListDrawer {
		InputTag src = genParticles
		untracked int32 maxEventsToPrint = -1
	}

	module printTree = ParticleTreeDrawer {
		InputTag src = genParticles
		untracked bool printP4 = false
		untracked bool printPtEtaPhi = true
		untracked bool printVertex = false
		untracked bool printStatus = true
		untracked bool printIndex = true
		untracked vint32 status = { 1, 2, 3 }
	}

	path p = {
		printTree,
		printList
	}

	module GEN = PoolOutputModule {
		using FEVTSIMEventContent
		untracked string fileName = "test.root"
		untracked PSet dataset = {
			untracked string dataTier = "GEN"
		}
	}
	replace GEN.outputCommands += "keep *_generator_*_*"

	endpath outpath = { GEN }

	schedule = { p0, outpath }
}
